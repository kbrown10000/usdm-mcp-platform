
  // CRITICAL: Handle Initialize to echo protocol version
  server.setRequestHandler(InitializeRequestSchema, async (request) => {
    console.error('[SALES-MCP] Initialize request received');
    console.error('[SALES-MCP] Client protocol version:', request.params.protocolVersion);
    
    // MUST echo the client's protocol version back (per AUTHENTICATION_DO_NOT_MODIFY.md)
    return {
      protocolVersion: request.params.protocolVersion,
      capabilities: {
        tools: {},
        prompts: {},
        resources: {}
      },
      serverInfo: {
        name: 'usdm-sales-mcp',
        version: '28.0.0'
      }
    };
  });
